'use strict';

Object.defineProperty(exports, '__esModule', {
    value: true
});
var env = process.env.NODE_ENV || 'development';

var util = require('util');
var fileName = util.format('%s.config.js', env);
var config = require('../../config/' + fileName);

config.env = env;
populateEachConfig(config);

function replaceTemplateTags(_x) {
    var _again = true;

    _function: while (_again) {
        var key = _x;
        _again = false;

        if (!key.length) {
            return config;
        }
        if (!Array.isArray(key)) {
            _x = key.split('.');
            _again = true;
            continue _function;
        }
        return key.reduce(function (result, i) {
            return result && result[i];
        }, config);
    }
}

function coerce(value) {
    if (typeof value !== 'string') {
        return value;
    }
    value = value.replace(/\$\(([^\)]+)\)/g, function (_, key) {
        return replaceTemplateTags(key);
    });
    if (/^\d+$/.test(value)) {
        return parseInt(value, 10);
    }
    if (value === 'false') {
        return false;
    }
    if (value === 'true') {
        return true;
    }
    return value;
}

function populateEachConfig(cfg) {
    Object.keys(cfg).forEach(function (key) {
        if (typeof cfg[key] === 'object' && cfg[key]) {
            return populateEachConfig(cfg[key]);
        }
        cfg[key] = coerce(cfg[key]);
    });
}

exports['default'] = config;
module.exports = exports['default'];
